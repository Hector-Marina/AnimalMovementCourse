---
title: "AM_Sep7_SocialNetworkAnalysis"
author: "Hector Marina"
date: "2023-09-04"
output: html_document
---

##C:\Users\user\Documents\\2 - Uppsala\\02-Analyses\\00-GitHubProjects\SocialNetworkAnalyses\scripts\\00-tests\\03-SNA_stERGM_reproducible.R ##And upload the corresponding files instead those that you uploaded already.

# Social network analysis

Introduction about the script. Different parts: with a short description and links intra-document.

1.  [Farm information](#RFI)
2.  [FA interpolated data](#RPAI)
3.  [Social contact information](#PAM)
4.  [Build the networks](#BTN)
5.  [Plot the networks](#PTN)
6.  [Estimate the topological parameters](#ETP)
7.  [Plot topological parameters](#PTP)
8.  [Filtering networks](#FNS)
9.  [Exponential random graph models](#ERGM)

### Required packages and functions

```{r pressure, echo=FALSE}
library(network) #version="1.17.2"
#library(statnet)
#library(plyr);library(dplyr)
#library(coda)
#library(tergm)
#library(tsna)
#library(ndtv)
#library(htmlwidgets)
#library(texreg)
#library(latticeExtra)

#source(".SocialNetworkAnalysis_functions.R")
```

## Farm information {#RFI}

Read cow information: cow information contains: ID tag matID Parity Lactation_stage Pregnancy_status Breed Claw_health Time_in_area

```{r}

CPheno <- read.table("../../data/raw/indoor/Cow_Phenotypes.csv", header = TRUE, sep = ",")
nrow(CPheno)

```

Reading Age contemporary matrix:

```{r}
AGEcont<-as.matrix(read.table("../../data/raw/indoor/AGEcontemporary_EarlyLactationGroup.csv", header = FALSE, sep = ","))
dim(AGEcont)
```



## FA interpolated data {#RPAI}

-   select two animals and plot contacts graphs?

```{r pressure, echo=FALSE}

ggplottt

```



## Social contact information {#PAM}

Read Adjacency contact matrices

```{r pressure, echo=FALSE}

ADJmat<-list()
ADJmat[["FeedingArea"]]<-as.matrix(read.table("../../data/raw/indoor/Adjacencymatrix_FeedingArea_EarlyLactationGroup_20201017.csv", header = FALSE, sep = ","))
ADJmat[["RestingArea"]]<-as.matrix(read.table("../../data/raw/indoor/Adjacencymatrix_RestingArea_EarlyLactationGroup_20201017.csv", header = FALSE, sep = ","))


```

Plot the adjacency matrices using a heatmap

::: columns
::: column
Feeding area

```{r pressure, echo=FALSE}
heatmap(ADJmat[["FeedingArea"]],Colv = NA,Rowv = NA, symm = TRUE, revC = TRUE)
```
:::

::: column
Resting area

```{r pressure, echo=FALSE}
heatmap(ADJmat[["RestingArea"]],Colv = NA,Rowv = NA, symm = TRUE, revC = TRUE)
```
:::


Check the number of social contacts detected in both functional areas:
::: columns
::: column
Feeding area

```{r pressure, echo=FALSE}
sum(ADJmat[["FeedingArea"]])

```
:::
::: column
Resting area

```{r pressure, echo=FALSE}
sum(ADJmat[["RestingArea"]])
```
:::


Percentage of contacts per functional area out of possible total social contacts detected:
::: columns
::: column
Feeding area

```{r pressure, echo=FALSE}
sum(ADJmat[["FeedingArea"]])/((nrow(ADJmat[["FeedingArea"]])^2)-nrow(ADJmat[["FeedingArea"]]))*100
```
:::
::: column
Resting area

```{r pressure, echo=FALSE}
sum(ADJmat[["RestingArea"]])/((nrow(ADJmat[["RestingArea"]])^2)-nrow(ADJmat[["RestingArea"]]))*100
```
:::



## Build the networks {#BTN}

Contact networks
```{r pressure, echo=FALSE}
FA_net <- network::network(ADJmat[["FeedingArea"]],directed=FALSE)
RA_net <- network::network(ADJmat[["RestingArea"]],directed=FALSE)
```

Age contemporary network
```{r pressure, echo=FALSE}
AGEnet <- network::network(AGEcont,directed=FALSE)
```


## Plot the networks {#PTN}

```{r pressure, echo=FALSE}
plot(AGEnet)
```

## Estimate the topological parameters {#ETP}

```{r pressure, echo=FALSE}
plot(pressure)
```

## Plot topological parameters {#PTP}

Regression wiht this information and the cows characteristics?

```{r pressure, echo=FALSE}
plot(pressure)
```

## Filtering networks {#FNS}

```{r pressure, echo=FALSE}
plot(pressure)
```

## Exponential random graph models {#ERGM}

Try all cows characteristics all together + one by one?

```{r pressure, echo=FALSE}
plot(pressure)
```
